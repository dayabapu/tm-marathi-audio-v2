<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TM Marathi Audio AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

<style>
body { text-align:center; font-family:Arial; }
button { font-size:18px; padding:12px 25px; margin:10px; }
canvas { margin-top:10px; }
</style>
</head>

<body>

<h2>Marathi Speaking AI</h2>

<button id="startBtn">▶ Start Camera</button>

<div id="webcam-container"></div>
<h3 id="result">Waiting...</h3>
<audio id="audioPlayer"></audio>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/qNs3g87f3/";

let model, webcam;
let lastPlayed = "";
let started = false;

document.getElementById("startBtn").addEventListener("click", startApp);

async function startApp() {
  if (started) return;
  started = true;

  try {
    // Load Teachable Machine model
    model = await tmImage.load(URL + "model.json", URL + "metadata.json");

    // Camera setup with flip = true
    webcam = new tmImage.Webcam(300, 300, true); 
    await webcam.setup();   // ✅ NO parameters!
    await webcam.play();

    // Show camera on page
    document.getElementById("webcam-container").appendChild(webcam.canvas);

    // Start prediction loop
    window.requestAnimationFrame(loop);

  } catch(e) {
    alert("Camera error! Refresh page and click Start Camera.");
    console.error(e);
  }
}

async function loop() {
  webcam.update();
  await predict();
  window.requestAnimationFrame(loop);
}

async function predict() {
  const prediction = await model.predict(webcam.canvas);
  prediction.sort((a,b)=>b.probability-a.probability);

  const label = prediction[0].className;
  document.getElementById("result").innerText = label;

  if(label !== lastPlayed) {
    playAudio(label);
    lastPlayed = label;
  }
}

function playAudio(label) {
  const audio = document.getElementById("audioPlayer");
  audio.src = "audio/" + label + ".mp3";
  audio.play().catch(()=>{});
}
</script>

</body>
</html>
